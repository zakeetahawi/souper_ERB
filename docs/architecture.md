# البنية المعمارية - ELKHAWAGA ERP

## نظرة عامة

نظام ELKHAWAGA ERP مبني على بنية موديولية قابلة للتوسع مع دعم كامل للعربية والإنجليزية.

## المكونات الرئيسية

### 1. Backend (Go)

#### التقنيات المستخدمة
- **Framework:** Fiber (HTTP Server)
- **ORM:** GORM (Database ORM)
- **Database:** PostgreSQL
- **Cache:** Redis
- **Authentication:** JWT + Single Device Sessions
- **Logging:** Zap

#### البنية المعمارية
```
backend/
├── cmd/server/          # نقطة الدخول الرئيسية
├── internal/
│   ├── config/          # إعدادات التطبيق
│   ├── db/             # طبقة قاعدة البيانات
│   ├── auth/           # المصادقة والصلاحيات
│   ├── modules/        # الموديولات المختلفة
│   ├── billing/        # نظام الفواتير
│   ├── settings/       # إعدادات النظام
│   ├── export/         # الاستيراد/التصدير
│   └── ui/            # إعدادات الواجهة
```

### 2. Frontend (Angular)

#### التقنيات المستخدمة
- **Framework:** Angular 17+
- **UI Library:** Angular Material
- **Styling:** Tailwind CSS
- **State Management:** Angular Services + RxJS
- **Internationalization:** Angular i18n
- **Components:** SweetAlert2, ng-select

#### البنية المعمارية
```
frontend/src/app/
├── core/               # الخدمات الأساسية
│   ├── layout/         # القالب الموحد
│   ├── auth/           # المصادقة
│   └── themes/         # الثيمات
├── shared/             # المكونات المشتركة
│   ├── components/     # المكونات القابلة لإعادة الاستخدام
│   └── utils/          # الأدوات المساعدة
└── pages/              # صفحات التطبيق
```

### 3. قاعدة البيانات (PostgreSQL)

#### الجداول الرئيسية
- `users` - المستخدمون
- `user_sessions` - جلسات المستخدمين
- `roles` - الأدوار
- `permissions` - الصلاحيات
- `feature_flags` - أعلام الميزات
- `customers` - العملاء
- `branches` - الفروع

## الميزات الأساسية

### 1. نظام الموديولات
- كل موديول مستقل وقابل للتفعيل/التعطيل
- تسجيل تلقائي للصلاحيات عند إضافة موديول جديد
- Feature Flags للتحكم في الوصول

### 2. نظام الصلاحيات (RBAC)
- أدوار ديناميكية
- صلاحيات مرتبطة بالموديولات
- تحكم دقيق في الوصول

### 3. الجلسات الفردية
- جلسة واحدة فعالة لكل مستخدم
- إلغاء تلقائي للجلسات السابقة
- تتبع الأجهزة

### 4. الثيمات المتعددة
- 4 ثيمات مختلفة
- حفظ تفضيلات المستخدم
- تبديل ديناميكي

## تدفق البيانات

1. **المصادقة:** JWT + Refresh Token
2. **الصلاحيات:** التحقق من الأدوار والصلاحيات
3. **Feature Flags:** التحقق من تفعيل الموديولات
4. **المعالجة:** تنفيذ العمليات المطلوبة
5. **الاستجابة:** إرجاع البيانات المطلوبة

## الأمان

- تشفير كلمات المرور (bcrypt)
- JWT مع انتهاء صلاحية قصير
- حماية من CSRF
- التحقق من صحة المدخلات
- تسجيل العمليات الحساسة 